# TypeScriptï¼šç±»å‹å®ˆå« (Type Guards)

## ğŸ“ æ¦‚è¿°
ç±»å‹å®ˆå«æ˜¯ TypeScript æä¾›çš„ä¸€ç§æœºåˆ¶ï¼Œç”¨äº **åœ¨è¿è¡Œæ—¶å¯¹å˜é‡è¿›è¡Œç±»å‹åˆ¤æ–­**ï¼Œä»è€Œè®©ç¼–è¯‘å™¨èƒ½å¤Ÿ **æ”¶çª„å˜é‡ç±»å‹**ï¼Œä¿è¯è®¿é—®å±æ€§æˆ–æ–¹æ³•æ—¶çš„ç±»å‹å®‰å…¨ã€‚  
æ ¸å¿ƒåœºæ™¯æ˜¯å¤„ç† **unknownã€any æˆ–è”åˆç±»å‹** çš„å˜é‡ã€‚


## ğŸ”‘ æ ¸å¿ƒåŸç†
å½“ä½ å¯¹ä¸€ä¸ªå˜é‡åšç±»å‹æ£€æŸ¥åï¼ŒTypeScript ä¼šè‡ªåŠ¨æ¨æ–­è¯¥å˜é‡åœ¨è¯¥åˆ†æ”¯å†…çš„ç±»å‹ï¼š
```ts
function printValue(value: string | number) {
  if (typeof value === 'string') {
    console.log(value.toUpperCase()); // TSçŸ¥é“è¿™é‡Œæ˜¯string
  } else {
    console.log(value.toFixed(2)); // TSçŸ¥é“è¿™é‡Œæ˜¯number
  }
}
````


## å¸¸ç”¨ç±»å‹å®ˆå«

### 1. åŸºç¡€ç±»å‹æ£€æŸ¥

```ts
function isString(value: unknown): value is string {
  return typeof value === 'string';
}

function isNumber(value: unknown): value is number {
  return typeof value === 'number';
}
```

### 2. å¯¹è±¡å±æ€§æ£€æŸ¥

```ts
function hasProperty<T extends string>(
  obj: unknown, 
  prop: T
): obj is Record<T, unknown> {
  return typeof obj === 'object' && obj !== null && prop in obj;
}
```

### 3. æ•°ç»„ç±»å‹æ£€æŸ¥

```ts
function isArrayOf<T>(
  value: unknown, 
  validator: (item: unknown) => item is T
): value is T[] {
  return Array.isArray(value) && value.every(validator);
}
```

### 4. è‡ªå®šä¹‰ç±»å‹ä¿æŠ¤ (User-defined Type Guard)

```ts
interface User { name: string; age: number; }

function isUser(value: unknown): value is User {
  return typeof value === 'object' && value !== null &&
         'name' in value && 'age' in value;
}
```


## âš¡ ä½¿ç”¨ç¤ºä¾‹

```ts
function handle(data: unknown) {
  if (isUser(data)) {
    console.log(data.name.toUpperCase()); // å®‰å…¨è®¿é—®
  }
}
```


## ğŸ”§ æ€»ç»“

1. ç±»å‹å®ˆå«å¯ä»¥æ”¶çª„å˜é‡ç±»å‹ï¼Œä¿è¯ç±»å‹å®‰å…¨ã€‚
    
2. å¯¹ **unknownã€anyã€è”åˆç±»å‹** ç‰¹åˆ«æœ‰ç”¨ã€‚
    
3. æ ¸å¿ƒæ¨¡å¼ï¼š
    
    - `typeof`
        
    - `instanceof`
        
    - å±æ€§æ£€æŸ¥ `in`
        
    - è‡ªå®šä¹‰ç±»å‹ä¿æŠ¤ `value is Type`
        
4. ä¸ `unknown` æ­é…ä½¿ç”¨ï¼Œå¯ä»¥å¼ºåˆ¶å¼€å‘è€…æ˜¾å¼åˆ¤æ–­ç±»å‹ï¼Œæé«˜ä»£ç å¯é æ€§ã€‚
    
## ğŸ”— å…³è”ç¬”è®°
[[any-vs-unknown]]

## ğŸ·ï¸ æ ‡ç­¾
#TypeScript #ç±»å‹ç³»ç»Ÿ #ç±»å‹å®ˆå« #ç±»å‹æ”¶çª„ #unknown  