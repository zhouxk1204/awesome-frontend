# 前端唯一 ID 生成的正确方式

## 📝 概要

在现代前端与 Node.js 环境中，生成“唯一 ID”的**最佳实践**是一行代码：`crypto.randomUUID()`。  
它基于密码学安全随机数，符合国际标准，在工程上可视为**不会重复**。

---

## 📌 核心知识点

- **“唯一”≠“看起来不重复”**  
    真正的唯一性需要考虑并发、刷新、多实例、跨设备、分布式等场景。

- **Date.now() + Math.random() 不可靠**  
    受限于毫秒精度与伪随机算法，在高并发或极端情况下存在碰撞风险。

- **UUID v4 是工业级解决方案**  
    基于 122 位随机数，组合空间巨大，碰撞概率趋近于 0。

- **crypto.randomUUID() 是官方标准实现**  
    浏览器与 Node.js 原生支持，无需第三方库。

---

## 📊 JavaScript 中的唯一 ID 生成方案对比

|方案|是否唯一|并发安全|刷新安全|多标签页|分布式|备注|
|---|---|---|---|---|---|---|
|`Date.now()`|❌|❌|✅|❌|❌|同毫秒必冲突|
|`Date.now() + Math.random()`|⚠️|⚠️|✅|⚠️|❌|看似安全，实则脆弱|
|自增 counter|❌|❌|❌|❌|❌|仅存在于单实例|
|`Math.random()`|❌|❌|✅|⚠️|❌|非加密随机|
|UUID v1|⚠️|✅|✅|✅|⚠️|含时间与设备信息|
|UUID v4|✅|✅|✅|✅|✅|当前主流方案|
|UUID v7|✅|✅|✅|✅|✅|时间有序，新趋势|
|`crypto.randomUUID()`|✅|✅|✅|✅|✅|原生 UUID v4|

> ✅ **工程结论**：  
> 在前端与 Node.js 环境中，**UUID v4 是当前最稳妥的默认选择**。

---

## 💻 示例代码

```js
// ✅ 推荐：现代浏览器 & Node.js 14+
const id = crypto.randomUUID();
// e.g. "3a6c4b2a-4c26-4d0f-a4b7-3b1a2b3c4d5e"
```

### 兼容性兜底（旧环境）

```js
function generateUUIDFallback() {
  return ([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g, c =>
    (c ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >> c / 4).toString(16)
  );
}
```

---

## ⚠️ 常见误区

- **误区 1：Date.now() + Math.random() 就够了**  
    ❌ 并发毫秒内调用必然存在风险

- **误区 2：自增 counter 很安全**  
    ❌ 页面刷新、多标签页、分布式环境全部失效

- **误区 3：UUID 太长，没必要**  
    ❌ 可读性 ≠ 唯一性，ID 首先是机器使用的

- **误区 4：UUID = 完全不可能重复**  
    ⚠️ 理论上仍可能，但概率小到工程上可忽略

---

## 🎯 适用场景

- 前端列表渲染（`key`）

- 表单临时数据 / 草稿 ID

- 前后端请求追踪 ID（Trace ID）

- 本地缓存 / IndexedDB / LocalStorage 主键

- 离线生成、稍后同步的数据标识

- 微前端 / 多实例应用中的唯一标识

---

## 🔗 关联笔记

- [[Math.random 为什么不安全]]

- [[UUID v1 v4 v7 的区别]]

- [[前端并发与唯一性问题]]

- [[浏览器 Crypto API 简介]]

---

## 🏷️ 标签

- #javascript #uuid #crypto #工程实践 #前端安全 #基础语法

---

## 🧠 知识库一句话总结

> **前端生成唯一 ID：默认用 `crypto.randomUUID()`，别再造轮子，也别再赌概率。**
