# å¤šæ ‡ç­¾é¡µçŠ¶æ€åŒæ­¥

## ğŸ“ æ¦‚è¦
åœ¨ç°ä»£ Web åº”ç”¨ä¸­ï¼Œç”¨æˆ·å¯èƒ½åŒæ—¶æ‰“å¼€å¤šä¸ªåŒæºæ ‡ç­¾é¡µã€‚ä¸ºäº†ä¿è¯ç”¨æˆ·ä½“éªŒå’Œæ•°æ®ä¸€è‡´æ€§ï¼Œéœ€è¦åœ¨æ ‡ç­¾é¡µä¹‹é—´åŒæ­¥çŠ¶æ€å’Œæ•°æ®ã€‚  

æµè§ˆå™¨é»˜è®¤æ¯ä¸ªæ ‡ç­¾é¡µæœ‰ç‹¬ç«‹çš„ JS è¿è¡Œç¯å¢ƒå’Œå†…å­˜ï¼Œè·¨æ ‡ç­¾é¡µé€šä¿¡éœ€è¦ç‰¹æ®ŠæŠ€æœ¯ã€‚

## ğŸ“Œ æ ¸å¿ƒçŸ¥è¯†ç‚¹

### 1ï¸âƒ£ localStorage + storage äº‹ä»¶
- åˆ©ç”¨åŒæºæ ‡ç­¾é¡µå…±äº«çš„ localStorage  
- å½“ä¸€ä¸ªæ ‡ç­¾é¡µä¿®æ”¹ localStorage æ—¶ï¼Œå…¶ä»–æ ‡ç­¾é¡µä¼šè§¦å‘ `storage` äº‹ä»¶  
- è§¦å‘äº‹ä»¶çš„æ ‡ç­¾é¡µæœ¬èº«ä¸ä¼šæ”¶åˆ°é€šçŸ¥  

#### ç¤ºä¾‹
```js
// æ ‡ç­¾é¡µ Aï¼šç”¨æˆ·ç™»å½•
function login(token) {
  localStorage.setItem('session', JSON.stringify({ token, timestamp: Date.now() }));
}

// æ ‡ç­¾é¡µ Bã€Cï¼šç›‘å¬ç™»å½•çŠ¶æ€å˜åŒ–
window.addEventListener('storage', (event) => {
  if (event.key === 'session') {
    if (event.newValue) console.log('ç™»å½•æ€æ›´æ–°');
    else console.log('ç™»å‡ºæ€æ›´æ–°');
  }
});
```

### 2ï¸âƒ£ BroadcastChannel API
- ä¸“é—¨ä¸ºè·¨æµè§ˆå™¨ä¸Šä¸‹æ–‡é€šä¿¡è®¾è®¡  
- åˆ›å»ºå‘½åé¢‘é“ï¼Œå‘å¸ƒ-è®¢é˜…æ¨¡å¼  
- æ”¯æŒå¤æ‚æ•°æ®ã€ä½å»¶è¿Ÿ  
- ä¸æ”¯æŒ IE

#### ç¤ºä¾‹
```js
const channel = new BroadcastChannel('my_channel');
channel.onmessage = (event) => console.log('æ”¶åˆ°æ¶ˆæ¯:', event.data);

// å‘é€æ¶ˆæ¯
channel.postMessage({ type: 'SYNC_STATE', payload: { count: 1 } });
```

### 3ï¸âƒ£ SharedWorker
- ä¸­å¤®çŠ¶æ€ç®¡ç†å™¨ï¼Œå¯è¢«å¤šä¸ªåŒæºæ ‡ç­¾é¡µå…±äº«  
- æä¾›å¥å£®çš„çŠ¶æ€åŒæ­¥å’Œå†²çªå¤„ç†èƒ½åŠ›  
- ç¼–ç è°ƒè¯•è¾ƒå¤æ‚ï¼Œä¸æ”¯æŒ IE

#### shared-worker.js
```js
const connectedPorts = [];
let sharedState = { count: 0 };

self.onconnect = (event) => {
  const port = event.ports[0];
  connectedPorts.push(port);

  port.postMessage({ type: 'SYNC_STATE', state: sharedState });

  port.onmessage = (e) => {
    const { type } = e.data;
    if (type === 'INCREMENT') sharedState.count++;

    connectedPorts.forEach(p => {
      p.postMessage({ type: 'STATE_UPDATE', state: sharedState });
    });
  };

  port.start();
};
```

#### main.jsï¼ˆæ¯ä¸ªæ ‡ç­¾é¡µï¼‰
```js
const worker = new SharedWorker('shared-worker.js');

document.getElementById('increment-btn').onclick = () => {
  worker.port.postMessage({ type: 'INCREMENT' });
};

worker.port.onmessage = (e) => {
  const { type, state } = e.data;
  console.log('æ”¶åˆ°æ¥è‡ª SharedWorker çš„çŠ¶æ€:', state);
};

worker.port.start();
```

## âœ… æŠ€æœ¯é€‰æ‹©å»ºè®®
- **ä¼˜å…ˆ BroadcastChannel**ï¼šç°ä»£æµè§ˆå™¨ï¼Œç®€å•é«˜æ•ˆ  
- **å…¼å®¹ IE æˆ–æ—§æµè§ˆå™¨**ï¼šé™çº§ä½¿ç”¨ localStorage  
- **å¤æ‚çŠ¶æ€åŒæ­¥**ï¼šä½¿ç”¨ SharedWorkerï¼Œä¿è¯æ•°æ®ä¸€è‡´æ€§  

## ğŸ”— å…³è”ç¬”è®°
<!-- å¯æ ¹æ®æœªæ¥ç›¸å…³å¡ç‰‡è¡¥å…… -->

## ğŸ·ï¸ æ ‡ç­¾
#javascript #è·¨æ ‡ç­¾é¡µ #çŠ¶æ€åŒæ­¥ #å‰ç«¯API
