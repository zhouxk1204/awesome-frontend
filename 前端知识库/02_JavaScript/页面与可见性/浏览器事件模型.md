# 浏览器事件模型

## 📝 概要

浏览器事件模型描述了事件如何在 DOM 中传播（捕获 → 目标 → 冒泡），以及事件委托、默认行为与取消、以及常见 API（`stopPropagation`、`stopImmediatePropagation`、`preventDefault`）的含义和使用场景。

## 📌 核心知识点

- 事件传播三阶段：**捕获 (capture)** → **目标 (target)** → **冒泡 (bubble)**。

- 事件监听可以指定为捕获期或冒泡期，默认是冒泡期(`addEventListener(type, handler, false)`)。

- **事件委托**：将事件监听放到父容器上，通过 `event.target` 判断实际触发元素，提高性能与维护性。

- `event.stopPropagation()`：阻止后续在传播路径上继续触达其他监听器（影响捕获或冒泡方向的剩余处理）。

- `event.stopImmediatePropagation()`：除了阻止传播，还阻止同一元素上后续相同阶段的其它监听器执行。

- `event.preventDefault()`：阻止浏览器执行该事件的默认行为（如阻止链接跳转、表单提交等）。

- 事件处理顺序与注册顺序有关（同一目标、同一阶段下，按注册顺序执行）。

## 💻 示例代码

```html
<body onclick="console.log('body')">
  <div id="parent">
    <button id="btn">Click</button>
  </div>
</body>

<script>
const btn = document.getElementById('btn');
const parent = document.getElementById('parent');

btn.addEventListener('click', (e) => {
  console.log('btn listener (bubble)');
});

parent.addEventListener('click', (e) => {
  console.log('parent listener (bubble)');
});

// 使用捕获
parent.addEventListener('click', (e) => {
  console.log('parent listener (capture)');
}, true);

// stopPropagation 示例
btn.addEventListener('click', (e) => {
  e.stopPropagation(); // 阻止进一步冒泡
  console.log('btn stops propagation');
});
</script>
```

**输出示意（若最后一个 btn 的 stopPropagation 生效）：**

```
btn listener (bubble)
btn stops propagation
// parent listener (bubble) 不会被触发
// body 不会收到该事件
```

## ⚠️ 常见误区

- ❌ **误区：事件只会冒泡到父节点**。实际上事件最終会到达 `document` / `window`（除非被 stopPropagation 或 native 层阻止）。

- ❌ **误区：preventDefault 会阻止事件传播**。`preventDefault()` 只阻止默认行为，不影响传播。

- ❌ **误区：stopPropagation 会阻止同一元素上后续监听器执行**。只有 `stopImmediatePropagation()` 才会阻止同一元素上的后续监听器。

- ❌ **误区：事件委托总是万能**。某些原生事件（如 focus/blur 在某些浏览器不冒泡，需使用 focusin/focusout 或捕获）需要特殊处理。

## 🎯 适用场景

- 使用事件委托管理大量类似元素（如列表、表格）以减少监听器数量。

- 需要阻止默认行为（如阻止表单提交或链接跳转）时使用 `preventDefault()`。

- 在复杂交互里区分捕获/冒泡以实现微妙的控制逻辑。

- 使用 `stopImmediatePropagation()` 在某些安全或优先级场景下中断其它监听器。

## 🔗 关联笔记

- [[事件委托原理]]

- [[React 合成事件机制]]

- [[浏览器安全与事件]]

## 🏷️ 标签

# javascript #DOM #事件模型 #前端基础

---

## 📚 参考资料

- MDN — Event reference: [https://developer.mozilla.org/zh-CN/docs/Web/API/Event](https://developer.mozilla.org/zh-CN/docs/Web/API/Event)

- MDN — EventTarget.addEventListener: [https://developer.mozilla.org/zh-CN/docs/Web/API/EventTarget/addEventListener](https://developer.mozilla.org/zh-CN/docs/Web/API/EventTarget/addEventListener)

- 《You Don't Know JS》 — 事件相关章节
